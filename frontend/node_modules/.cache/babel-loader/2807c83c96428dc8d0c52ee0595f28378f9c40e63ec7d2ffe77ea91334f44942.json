{"ast":null,"code":"import React,{useState}from'react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const FeedbackButton=_ref=>{let{messageId,onFeedbackSubmitted}=_ref;const[showModal,setShowModal]=useState(false);const[comment,setComment]=useState('');const[isSubmitting,setIsSubmitting]=useState(false);const[submitted,setSubmitted]=useState(false);const handleSubmitFeedback=async e=>{e.preventDefault();setIsSubmitting(true);try{const userInfo=JSON.parse(localStorage.getItem('csaUserInfo')||'{}');const feedbackData={query_id:messageId,feedback_type:'incorrect_answer',comment:comment.trim()||null,user_id:userInfo.id||null};const response=await fetch('/api/feedback',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(feedbackData)});if(!response.ok){throw new Error(\"Failed to submit feedback: \".concat(response.status));}setSubmitted(true);// Notify parent component\nif(onFeedbackSubmitted){onFeedbackSubmitted(messageId,comment);}// Auto-close after 2 seconds\nsetTimeout(()=>{setShowModal(false);setSubmitted(false);setComment('');},2000);}catch(error){console.error('Feedback submission error:',error);alert('Failed to submit feedback. Please try again.');}finally{setIsSubmitting(false);}};const handleClose=()=>{setShowModal(false);setComment('');setSubmitted(false);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowModal(true),className:\"text-sm text-gray-500 hover:text-red-600 transition-colors duration-200 flex items-center gap-1\",title:\"Report incorrect answer\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-lg\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Incorrect answer?\"})]}),showModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl max-w-md w-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:!submitted?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl mr-2\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900\",children:\"Report Incorrect Answer\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"Help us improve! Let us know what was incorrect about this response. Your feedback helps train our system to provide better answers.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitFeedback,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"comment\",className:\"block text-sm font-medium text-gray-700 mb-2\",children:[\"What was incorrect? \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"(optional)\"})]}),/*#__PURE__*/_jsx(\"textarea\",{id:\"comment\",value:comment,onChange:e=>setComment(e.target.value),placeholder:\"e.g., Wrong year, missing information, factual error...\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",rows:\"3\",disabled:isSubmitting})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSubmitting,className:\"flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:bg-red-400 disabled:cursor-not-allowed transition-colors\",children:isSubmitting?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}),\"Submitting...\"]}):'Submit Report'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleClose,disabled:isSubmitting,className:\"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors\",children:\"Cancel\"})]})]})]}):/*#__PURE__*//* Success Message */_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-4xl mb-3\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-green-900 mb-2\",children:\"Feedback Submitted!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-green-700\",children:\"Thank you for helping us improve. Your report has been recorded.\"})]})})})})]});};export default FeedbackButton;","map":{"version":3,"names":["React","useState","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","FeedbackButton","_ref","messageId","onFeedbackSubmitted","showModal","setShowModal","comment","setComment","isSubmitting","setIsSubmitting","submitted","setSubmitted","handleSubmitFeedback","e","preventDefault","userInfo","JSON","parse","localStorage","getItem","feedbackData","query_id","feedback_type","trim","user_id","id","response","fetch","method","headers","body","stringify","ok","Error","concat","status","setTimeout","error","console","alert","handleClose","children","onClick","className","title","onSubmit","htmlFor","value","onChange","target","placeholder","rows","disabled","type"],"sources":["/project/workspace/ask.shag.dance/frontend/src/components/FeedbackButton.jsx"],"sourcesContent":["import React, { useState } from 'react';\n\nconst FeedbackButton = ({ messageId, onFeedbackSubmitted }) => {\n  const [showModal, setShowModal] = useState(false);\n  const [comment, setComment] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n\n  const handleSubmitFeedback = async (e) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      const userInfo = JSON.parse(localStorage.getItem('csaUserInfo') || '{}');\n      \n      const feedbackData = {\n        query_id: messageId,\n        feedback_type: 'incorrect_answer',\n        comment: comment.trim() || null,\n        user_id: userInfo.id || null\n      };\n\n      const response = await fetch('/api/feedback', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(feedbackData)\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to submit feedback: ${response.status}`);\n      }\n\n      setSubmitted(true);\n      \n      // Notify parent component\n      if (onFeedbackSubmitted) {\n        onFeedbackSubmitted(messageId, comment);\n      }\n\n      // Auto-close after 2 seconds\n      setTimeout(() => {\n        setShowModal(false);\n        setSubmitted(false);\n        setComment('');\n      }, 2000);\n\n    } catch (error) {\n      console.error('Feedback submission error:', error);\n      alert('Failed to submit feedback. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    setShowModal(false);\n    setComment('');\n    setSubmitted(false);\n  };\n\n  return (\n    <>\n      {/* Feedback Button */}\n      <button\n        onClick={() => setShowModal(true)}\n        className=\"text-sm text-gray-500 hover:text-red-600 transition-colors duration-200 flex items-center gap-1\"\n        title=\"Report incorrect answer\"\n      >\n        <span className=\"text-lg\">⚠️</span>\n        <span>Incorrect answer?</span>\n      </button>\n\n      {/* Feedback Modal */}\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6\">\n              {!submitted ? (\n                <>\n                  {/* Header */}\n                  <div className=\"flex items-center mb-4\">\n                    <span className=\"text-2xl mr-2\">⚠️</span>\n                    <h3 className=\"text-lg font-semibold text-gray-900\">\n                      Report Incorrect Answer\n                    </h3>\n                  </div>\n\n                  {/* Description */}\n                  <p className=\"text-gray-600 mb-4\">\n                    Help us improve! Let us know what was incorrect about this response.\n                    Your feedback helps train our system to provide better answers.\n                  </p>\n\n                  {/* Feedback Form */}\n                  <form onSubmit={handleSubmitFeedback}>\n                    <div className=\"mb-4\">\n                      <label htmlFor=\"comment\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        What was incorrect? <span className=\"text-gray-400\">(optional)</span>\n                      </label>\n                      <textarea\n                        id=\"comment\"\n                        value={comment}\n                        onChange={(e) => setComment(e.target.value)}\n                        placeholder=\"e.g., Wrong year, missing information, factual error...\"\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n                        rows=\"3\"\n                        disabled={isSubmitting}\n                      />\n                    </div>\n\n                    {/* Buttons */}\n                    <div className=\"flex space-x-3\">\n                      <button\n                        type=\"submit\"\n                        disabled={isSubmitting}\n                        className=\"flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:bg-red-400 disabled:cursor-not-allowed transition-colors\"\n                      >\n                        {isSubmitting ? (\n                          <div className=\"flex items-center justify-center\">\n                            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                            Submitting...\n                          </div>\n                        ) : (\n                          'Submit Report'\n                        )}\n                      </button>\n                      \n                      <button\n                        type=\"button\"\n                        onClick={handleClose}\n                        disabled={isSubmitting}\n                        className=\"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors\"\n                      >\n                        Cancel\n                      </button>\n                    </div>\n                  </form>\n                </>\n              ) : (\n                /* Success Message */\n                <div className=\"text-center\">\n                  <div className=\"text-4xl mb-3\">✅</div>\n                  <h3 className=\"text-lg font-semibold text-green-900 mb-2\">\n                    Feedback Submitted!\n                  </h3>\n                  <p className=\"text-green-700\">\n                    Thank you for helping us improve. Your report has been recorded.\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default FeedbackButton;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}